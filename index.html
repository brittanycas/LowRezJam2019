<!doctype html>
<html lang="en">
  <head>
      <meta charset="UTF-8" />
      <title>Dungeon Adventure</title>
      <script src="//cdn.jsdelivr.net/npm/phaser@3.19.0/dist/phaser.js"></script>
      <link href="./style.css" type="text/css" rel="stylesheet">
  </head>
  <body>
    <div id="game_window">
      <script type="text/javascript">
        var gameWidth = 64;
        var gameHeight = 64;
        var gameOver = false;

        var config = {
            type: Phaser.AUTO,
            scale: {
              mode: Phaser.Scale.FIT,
              autoCenter: Phaser.Scale.CENTER_BOTH,
              width: gameWidth,
              height: gameHeight,
              min: {
                width: 64,
                height: 64,
              },
              max: {
                width: 512,
                height: 512
              }
            },
            scene: {
                preload: preload,
                create: create,
                update: update,
            },
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 200 },
                    debug: false
                }
            }
          };

        var game = new Phaser.Game(config);

        function preload ()
        {
          //Load in required assets
          this.load.image('background', 'assets/background.png');
          this.load.image('ground', 'assets/platform.png');
          this.load.image('ground-sm', 'assets/platform-sm.png')
          this.load.image('platform', 'assets/platform1.png');
          this.load.image('goal-platform', 'assets/platform-goal.png')
          this.load.image('lava', 'assets/lava.png');
          this.load.image('lava-md', 'assets/lava-md.png');
          this.load.image('lava-lg', 'assets/lava-lg.png');
          this.load.spritesheet('dude',
              'assets/testsprite.png',
              { frameWidth: 10, frameHeight: 12 }
            );
        }

        function create ()
        {
            //set up world and camera
            this.physics.world.setBounds(0, 0, 384, 64);
            camera = this.cameras.main;
            camera.setBounds(0, 0, 384, 64);

            this.add.image(0, 0, 'background').setOrigin(0);

            //load in lava traps
            lavaTrap = this.physics.add.staticGroup();
            lavaTrap.create(97, 62, 'lava');
            lavaTrap.create(126, 62, 'lava');
            lavaTrap.create(208, 62, 'lava-lg');
            lavaTrap.create(280, 62, 'lava-md');
            lavaTrap.create(310, 62, 'lava-md');
            lavaTrap.create(340, 62, 'lava-md');
            lavaTrap.create(384, 62, 'lava-md');


            //load in static ground
            ground = this.physics.add.staticGroup();
            ground.create(43, 62, 'ground');
            ground.create(112, 62, 'ground-sm');
            ground.create(140, 62, 'ground-sm');
            ground.create(150, 62, 'ground-sm');
            ground.create(264, 62, 'ground-sm');
            ground.create(296, 62, 'ground-sm');
            ground.create(324, 62, 'ground-sm');
            ground.create(362, 62, 'goal-platform');

            //load floating platforms
            ground.create(85, 56, 'platform');
            ground.create(174, 54, 'platform');
            ground.create(191, 47, 'platform');
            ground.create(206, 41, 'platform');
            ground.create(216, 41, 'platform');
            ground.create(235, 53, 'platform');


            //load in player
            player = this.physics.add.sprite(10, 20, 'dude');
            player.setCollideWorldBounds(true);
            player.setBounce(0.2);
            playerSpeed = 25;

            //set player collisions
            this.physics.add.collider(player, ground);

            //set player animations
            this.anims.create({
                key: 'left',
                frames: this.anims.generateFrameNumbers('dude', { start: 0, end: 3 }),
                frameRate: 10,
                repeat: -1
            });
            this.anims.create({
                key: 'turn',
                frames: [ { key: 'dude', frame: 4 } ],
                frameRate: 20
            });
            this.anims.create({
                key: 'right',
                frames: this.anims.generateFrameNumbers('dude', { start: 5, end: 8 }),
                frameRate: 10,
                repeat: -1
            });

            //set camera to follow player
            camera.startFollow(player, true);

            //set up keyboard inputs
            cursors = this.input.keyboard.createCursorKeys();
        }

        function update ()
          {
            if (gameOver == true) {
              return
            }
            viewportLeft = camera.worldView.left;
            viewportTop = camera.worldView.top;
            camera.deadzone = new Phaser.Geom.Rectangle(0, 0, 8, 8);
            if (cursors.left.isDown){
                player.anims.play('left', true);
                if(player.x-5 > viewportLeft) {
                    player.setVelocityX(-playerSpeed)
                }
                else {
                  player.setVelocityX(0);
                }
            }
            else if (cursors.right.isDown){
                player.anims.play('right', true);
                player.setVelocityX(playerSpeed);
            }
            else {
                player.setVelocityX(0);
                player.anims.play('turn');
            }
            if (cursors.up.isDown && player.body.touching.down){
                player.setVelocityY(-60);
            }

          }


      </script>
    </div>
  </body>
</html>
